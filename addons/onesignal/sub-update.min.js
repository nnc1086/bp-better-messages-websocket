var timeoutId,user_id=parseInt(Better_Messages.user_id),OneSignalUpdate=function(){BetterMessages.getApi().then((function(e){BetterMessages.getSetting("oneSignal").then((function(n){let i=!1;OneSignal.getUserId().then((function(t){t&&(n?(n.user_id!=user_id&&(i=!0),n.subscription_id!=t&&(i=!0)):i=!0,i&&(timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout((function(){e.post("oneSignal/updateSubscription",{subscription_id:t}).then((function(e){BetterMessages.updateSetting("oneSignal",{user_id:user_id,subscription_id:t}),OneSignal.setExternalUserId(user_id)})).catch((function(e){console.error(e)}))}),3e3)))}))}))}))};if("undefined"!=typeof OneSignal)OneSignal.push((function(){OneSignal.isPushNotificationsEnabled().then((function(e){e&&OneSignalUpdate()})),OneSignal.on("subscriptionChange",(function(e){e&&OneSignalUpdate()}))}));else{function initNewSDK(e){e.initialized?(updateUser(),e.User.addEventListener("change",(function(e){updateUser()})),e.User.PushSubscription.addEventListener("change",(function(e){updateUser()}))):setTimeout((function(){initNewSDK(e)}),1e3)}function updateUser(){BetterMessages.getApi().then((function(e){BetterMessages.getSetting("oneSignal2025").then((function(n){let i=!1;n?(n.user_id!=OneSignal.User.externalId&&(i=!0),n.subscription_id!=OneSignal.User.PushSubscription.id&&(i=!0)):i=!0,i&&(timeoutId&&clearTimeout(timeoutId),timeoutId=setTimeout((function(){e.post("oneSignal/updateSubscription",{subscription_id:OneSignal.User.PushSubscription.id}).then((function(e){BetterMessages.updateSetting("oneSignal2025",{user_id:user_id,subscription_id:OneSignal.User.PushSubscription.id}),OneSignal.login(user_id.toString())})).catch((function(e){console.error(e)}))}),3e3))}))}))}window.OneSignalDeferred=window.OneSignalDeferred||[],OneSignalDeferred.push((function(e){initNewSDK(e)}))}
